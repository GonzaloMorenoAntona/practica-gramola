<div class="card" *ngIf="isFullWidth" style="border-left: 5px solid #0a192f;"> 
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; padding: 10px 15px;">
    
    <strong class="card-title" style="margin: 0;">Buscar Canción</strong>
    
    <button (click)="goToLogin()" 
            style="
                background-color: #d32f2f; 
                color: white; 
                border: none; 
                border-radius: 4px; 
                padding: 5px 10px; 
                font-size: 11px; 
                font-weight: bold; 
                cursor: pointer; 
                line-height: 1; 
                min-width: auto; 
                width: auto;">
            Volver al Panel de Control
        </button>
    </div>
  
  <div class="list" style="padding: 15px; display: flex; gap: 10px;">
    <input type="text" 
            [(ngModel)]="searchQuery" 
            (keyup.enter)="search()" 
            placeholder="Escribe título o artista..." 
            style="flex-grow: 1; padding: 10px; background-color: #f0f2f5; border: 1px solid #ccc; color: #333; border-radius: 4px;">
    
    <button class="link-btn" (click)="search()" style="background-color: #0a192f; color: white;">Buscar</button>
  </div>

  <div class="list" *ngIf="searchResults.length > 0" style="background: #fff; border-top: 1px solid #eee;">
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: #f8f9fa;">
          <span style="font-weight: bold; color: #555;">Resultados</span>
          <button (click)="clearSearch()" style="background: transparent; color: #999; border: none; cursor: pointer;">Cerrar ✕</button>
      </div>
      
      <table style="width: 100%; border-collapse: collapse;">
        <tbody>
          <tr *ngFor="let track of searchResults" style="border-bottom: 1px solid #eee;">
            <td style="width: 60px; padding: 10px;">
              <img [src]="track.album.images[2]?.url" width="50" height="50" style="border-radius: 4px; display: block; object-fit: cover;">
            </td>
            
            <td style="padding: 10px;">
              <div style="font-weight: 600; color: #333; font-size: 15px;">{{ track.name }}</div>
              <small style="color: #666;">{{ track.artists[0].name }}</small>
            </td>
            
            <td style="text-align: right; padding: 10px;">
              <button class="link-btn" (click)="openPaymentModal(track)" style="font-size: 13px; background-color: #0a192f; border-radius: 4px;">
                Comprar {{ songPrice }} €
              </button>
            </td>
          </tr>
        </tbody>
      </table>
  </div>
  
  <div *ngIf="searchError" style="padding: 15px; color: #d32f2f;">{{ searchError }}</div>
</div>

<div class="card" *ngIf="currentTrack" style="border-left: 5px solid #0a192f;"> 
  <div class="card-header">
    <strong class="card-title">Sonando Ahora</strong>
  </div>
  <div class="list" style="padding: 20px; display: flex; align-items: center; gap: 20px;">
    <img [src]="currentTrack.album.images[0]?.url" width="80" height="80" style="border-radius: 4px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
    <div>
      <h2 style="margin: 0 0 5px 0; font-size: 1.3em; color: #333;">{{ currentTrack.name }}</h2>
      <p style="margin: 0; font-size: 1em; color: #555;">{{ currentTrack.artists[0].name }}</p>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <strong class="card-title">Cola de Reproducción</strong>
  </div>

  <div class="list">
    <table *ngIf="queue.length > 0">
      <thead>
        <tr style="background: #f8f9fa; color: #777; font-size: 0.9em;">
          <th style="width: 40px; text-align: center;">#</th>
          <th style="width: 60px;">Portada</th>
          <th>Título</th>
          <th>Artista</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let track of queue; let i = index" style="border-bottom: 1px solid #f5f5f5;">
          <td style="text-align: center; color: #333; font-weight: bold;">{{ i + 1 }}</td>
          <td>
            <img [src]="track.album.images[2]?.url" width="40" style="border-radius: 2px; vertical-align: middle;">
          </td>
          <td style="font-weight: 500; color: #333;">{{ track.name }}</td>
          <td style="color: #666;">{{ track.artists[0].name }}</td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="queue.length === 0" style="padding: 30px; text-align: center; color: #999;">
      La cola está vacía.
    </div>
  </div>
</div>

<div *ngIf="showPaymentModal" 
     style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.7); z-index: 2000; 
            display: flex; justify-content: center; align-items: center;">
    
    <div style="width: 100%; max-width: 500px; padding: 10px;">
        <app-payment 
            [mode]="'song'"
            [songTrack]="selectedTrack"
            [songPrice]="songPrice"
            (songPaid)="onSongPaid($event)" 
            (close)="showPaymentModal = false">
        </app-payment>
    </div>

</div>