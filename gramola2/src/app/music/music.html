<h2 style="text-align: center; margin: 20px 0; color: #333;">üé∂ La Gramola üé∂</h2>

<div style="text-align: center; margin-bottom: 20px;">
  <button (click)="toggleMode()" class="link-btn" style="background: #333; color: white; border-radius: 20px; padding: 5px 15px;">
    Modo Actual: <strong>{{ isAdmin ? 'DUE√ëO' : 'CLIENTE' }}</strong>
  </button>
</div>

<div class="dashboard-container">

  <div class="left-column" *ngIf="isAdmin">
    
    <div class="card">
      <div class="card-header">
        <strong class="card-title">Dispositivos</strong>
        <button class="link-btn" type="button" (click)="getDevices()">Actualizar</button>
      </div>

      <div class="list">
        <div class="row" *ngFor="let device of devices">
          <span>
            <span *ngIf="device.is_active">üé∂</span>
            {{ device.name }} - {{ device.type }} - {{ device.id }}
            <span *ngIf="device.is_active">üé∂</span>
          </span>
        </div>
      </div>
      <div class="error" *ngIf="deviceError">{{ deviceError }}</div>
    </div>

    <div class="card">
      <div class="card-header">
        <strong class="card-title">Playlists</strong>
        <button class="link-btn" type="button" (click)="getPlaylists()">Actualizar</button>
      </div>

      <div class="list">
        <div class="row" *ngFor="let p of playlists" 
             (click)="selectPlaylist(p)"
             style="cursor: pointer; padding: 8px; border-bottom: 1px solid #eee; transition: background 0.2s;">
          
          <span style="font-weight: 500;">üéµ {{ p.name }}</span>
          <br>
          <small style="color: #666;">({{ p.tracks.total }} canciones)</small>
        </div>
      </div>
      
      <div class="error" *ngIf="playlistError">{{ playlistError }}</div>
    </div>

  </div> 

  <div class="right-column" [class.full-width]="!isAdmin">

    <div class="card search-card" style="border-left: 5px solid #1db954;"> 
      <div class="card-header">
        <strong class="card-title">Buscar Canci√≥n</strong>
      </div>
      
      <div class="list" style="padding: 15px; display: flex; gap: 10px;">
        <input type="text" 
               [(ngModel)]="searchQuery" 
               (keyup.enter)="search()" 
               placeholder="Escribe t√≠tulo o artista" 
               style="flex-grow: 1; padding: 10px; font-size: 16px;">
               
        <button class="link-btn" (click)="search()">Buscar</button>
      </div>

      <div class="list" *ngIf="searchResults.length > 0">
        <h4 style="margin: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">Resultados:</h4>
        
        <table style="width: 100%; border-collapse: collapse;">
          <tbody>
            <tr *ngFor="let track of searchResults" style="border-bottom: 1px solid #eee;">
              <td style="padding: 8px;">
                <img [src]="track.album.images[2]?.url" width="40" style="vertical-align: middle; margin-right: 10px;">
                <span style="font-weight: bold;">{{ track.name }}</span>
                <br>
                <small style="color: #666;">{{ track.artists[0].name }}</small>
              </td>
              
              <td style="text-align: right;">
                <button class="link-btn" (click)="openPaymentModal(track)" style="background: #333; color: white;">
                  Comprar (1,00‚Ç¨)
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="error" *ngIf="searchError">{{ searchError }}</div>
    </div>

    <div class="card" *ngIf="queue.length > 0">
      <div class="card-header">
        <strong class="card-title">Canciones en Cola</strong>
        <small>({{ queue.length }} canciones)</small>
      </div>

      <div class="list">
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="text-align: left; color: #888; border-bottom: 1px solid #ddd;">
              <th style="padding: 8px;">#</th>
              <th>T√≠tulo</th>
              <th>Artista</th>
              <th>√Ålbum</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let track of queue; let i = index" 
                class="track-row" 
                style="border-bottom: 1px solid #eee;"
                [style.background-color]="track.isPaid ? '#e6fffa' : 'transparent'"
                [style.font-weight]="track.isPaid ? 'bold' : 'normal'">
                
              <td style="padding: 8px;">
                 <span *ngIf="track.isPaid">üí∏</span> 
                 {{ i + 1 }}
              </td>
              <td style="font-weight: 500;">{{ track.name }}</td>
              <td>{{ track.artists[0].name }}</td>
              <td>{{ track.album.name }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card" *ngIf="queue.length === 0">
      <div class="list" style="padding: 20px; text-align: center; color: #666;">
        <p>La cola est√° vac√≠a. Selecciona una playlist a la izquierda para cargar m√∫sica.</p>
      </div>
    </div>

  </div> 
</div> 

<div *ngIf="showPaymentModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; justify-content: center; align-items: center;">
  
  <div style="background: white; padding: 30px; border-radius: 8px; width: 400px; text-align: center;">
    <h3>Confirmar Pago</h3>
    <p>Canci√≥n: <strong>{{ selectedTrack?.name }}</strong></p>
    <p>Precio: <strong style="color: #1db954;">1,00 ‚Ç¨</strong></p>

    <div style="margin: 20px 0; padding: 15px; border: 1px solid #ccc; background: #f9f9f9;">
      <div id="card-element"></div>
    </div>

    <div *ngIf="paymentError" style="color: red; margin-bottom: 10px;">{{ paymentError }}</div>

    <div style="display: flex; justify-content: space-between;">
      <button (click)="cancelPayment()" [disabled]="isProcessing" style="padding: 10px;">Cancelar</button>
      <button (click)="confirmPayment()" [disabled]="isProcessing" style="background: #1db954; color: white; padding: 10px; border: none; font-weight: bold;">
        {{ isProcessing ? 'Pagando...' : 'Pagar Ahora' }}
      </button>
    </div>
  </div>
</div>